---
import { getCollection, render } from 'astro:content';
import Layout from '../../components/Layout.astro';
import Toc from '../../components/Toc.astro';

export async function getStaticPaths() {
  const posts = await getCollection('posts');
  return posts.map((post) => ({ params: { slug: post.slug }, props: { post } }));
}

const { post } = Astro.props;
const { Content, headings } = await render(post);

const title = `${post.data.title} · LoveClaw`;
const description = post.data.summary;
const canonicalPath = `/posts/${post.slug}/`;
---

<Layout
  title={title}
  description={description}
  canonicalPath={canonicalPath}
  pageType="article"
  pubDate={post.data.date}
>
  <style>
    article :global(img) {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
    }
  </style>

  <p class="muted" style="margin: 0 0 10px;"><a href="/">← 返回首页</a></p>

  <div class="post-grid">
    <div>
      <header style="margin-bottom: 18px;">
        <h1 style="margin-bottom: 8px;">{post.data.title}</h1>
        <div class="muted">{post.data.date.toISOString().slice(0, 10)}</div>
        {post.data.summary ? <p class="muted" style="margin-top: 10px;">{post.data.summary}</p> : null}
      </header>

      <article>
        <Content />
      </article>
    </div>

    <Toc headings={headings} />
  </div>
</Layout>
